<div class="container">
    <div class="content">
      <div style="font-size: 24px;">Reconocimiento doble: fruta y otra cosa</div>
      <button type="button" class="button" onclick="init(); this.style.display='none';">
        <span class="inner">Reconocer</span>
      </button>
      <div id="webcam-container"></div>
      <div id="label-container1"></div>
      <div id="label-container2"></div>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>
  
  <script>
    const URL1 = "https://teachablemachine.withgoogle.com/models/cJfrqDB0z/"; // Modelo 1: frutas
    const URL2 = "https://teachablemachine.withgoogle.com/models/sB6WIaOPi/"; // Modelo 2: otra cosa
  
    let model1, model2, webcam;
    let maxPredictions1, maxPredictions2;
    let labelContainer1, labelContainer2;
  
    async function init() {
      const modelURL1 = URL1 + "model.json";
      const metadataURL1 = URL1 + "metadata.json";
      const modelURL2 = URL2 + "model.json";
      const metadataURL2 = URL2 + "metadata.json";
  
      model1 = await tmImage.load(modelURL1, metadataURL1);
      model2 = await tmImage.load(modelURL2, metadataURL2);
  
      maxPredictions1 = model1.getTotalClasses();
      maxPredictions2 = model2.getTotalClasses();
  
      const flip = true;
      webcam = new tmImage.Webcam(400, 400, flip);
      await webcam.setup();
      await webcam.play();
      window.requestAnimationFrame(loop);
  
      const webcamContainer = document.getElementById("webcam-container");
      const splitCanvas = document.createElement("canvas");
      splitCanvas.width = 600;
      splitCanvas.height = 400;
      splitCanvas.id = "split-canvas";
      webcamContainer.appendChild(splitCanvas);
  
      labelContainer1 = document.getElementById("label-container1");
      labelContainer2 = document.getElementById("label-container2");
  
      for (let i = 0; i < maxPredictions1; i++) labelContainer1.appendChild(document.createElement("div"));
      for (let i = 0; i < maxPredictions2; i++) labelContainer2.appendChild(document.createElement("div"));
    }
  
    async function loop() {
      webcam.update();
      await predictModel1(webcam.canvas);
      await predictModel2(webcam.canvas);
  
      const splitCanvas = document.getElementById("split-canvas");
      const ctx = splitCanvas.getContext("2d");
      ctx.clearRect(0, 0, splitCanvas.width, splitCanvas.height);
  
      // Mostrar cámara completa a la izquierda
      ctx.drawImage(webcam.canvas, 0, 0, webcam.canvas.width, webcam.canvas.height, 0, 0, splitCanvas.width * 2 / 3, splitCanvas.height);
  
      // Mostrar recorte en la derecha
      const x = 300, y = 50, w = 100, h = 200;
      ctx.drawImage(webcam.canvas, x, y, w, h, splitCanvas.width * 2 / 3, 0, splitCanvas.width / 3, splitCanvas.height);
  
      window.requestAnimationFrame(loop);
    }
  
    async function predictModel1(sourceCanvas) {
      const prediction = await model1.predict(sourceCanvas);
      for (let i = 0; i < maxPredictions1; i++) {
        const classPrediction = `${prediction[i].className}: ${(prediction[i].probability * 100).toFixed(1)}%`;
        labelContainer1.childNodes[i].innerHTML = classPrediction;
      }
  
      // Si detecta con alta probabilidad, puedes hacer algo
      const highProb = prediction.find(p => p.probability > 0.9);
      if (highProb) {
        showAnimation(`Fruta: ${highProb.className}`);
        // Ejemplo de redirección o acción personalizada
      }
    }
  
    async function predictModel2(sourceCanvas) {
      // Crear canvas temporal para recorte
      const tempCanvas = document.createElement("canvas");
      const ctx = tempCanvas.getContext("2d");
      const x = 300, y = 50, w = 100, h = 200;
      tempCanvas.width = w;
      tempCanvas.height = h;
      ctx.drawImage(sourceCanvas, x, y, w, h, 0, 0, w, h);
  
      const prediction = await model2.predict(tempCanvas);
      for (let i = 0; i < maxPredictions2; i++) {
        const classPrediction = `${prediction[i].className}: ${(prediction[i].probability * 100).toFixed(1)}%`;
        labelContainer2.childNodes[i].innerHTML = classPrediction;
      }
  
      const highProb = prediction.find(p => p.probability > 0.9);
      if (highProb) {
        showAnimation(`Etiqueta: ${highProb.className}`);
      }
    }
  
    function showAnimation(text) {
      const animationContainer = document.createElement("div");
      animationContainer.className = "animation-container";
      animationContainer.innerHTML = `<div class="animation-content">${text}</div>`;
      document.body.appendChild(animationContainer);
      setTimeout(() => animationContainer.remove(), 3000);
    }
  </script>
  
  <style>
    .animation-container {
      position: fixed;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      background: #444;
      color: white;
      padding: 10px 20px;
      border-radius: 10px;
      font-size: 18px;
      z-index: 9999;
    }
  </style>
  